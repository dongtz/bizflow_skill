# Capture 工作流：提炼 MIS + 流程骨架

从 `inputs/00_raw.md` 中抽取最小事实集（MIS），生成流程骨架与确认点 ≤10。

## 输入参数

- `last=N`：分析最新 N 条 Entry（默认 80）
- 示例："提炼流程 last=50"

---

## Step 0 — 参数解析与取数

1. 解析 `last=N`；未提供则默认 80
2. 读取 `inputs/00_raw.md` 顶部索引表（Raw Index）
3. 取索引中最新 N 条 EntryId 作为本轮"主分析集"
4. 定位并读取这些 EntryId 对应的原文块（保持原样）

## Step 1 — 材料解析（事实 vs 观点）

从主分析集中抽取：

| 类别 | 内容 |
|------|------|
| **事实陈述** | 流程步骤、规则、口径、异常处理、责任归属 |
| **观点/建议** | 仅作为待确认候选 |
| **实体要素** | 角色、系统、数据对象、动作、时间阈值条件 |

**媒体处理：**
- 检查索引中 Media 列，识别含图片/视频的 Entry
- 含图片的 Entry（如 UI 截图、流程图、表单截图）：
  - 若 AI 具备多模态能力（可读图）：读取图片提取流程信息，与文字描述交叉验证
  - 若不具备：在 MIS 中标注 `【含图片 EntryId:XXX，需人工确认图中内容】`
- 含视频的 Entry：标注 `【含视频 EntryId:XXX，需人工确认视频内容】`

**约束：不得脑补。无法确定则标 `【待确认】`。**

## Step 2 — 冲突识别与旧证据拉取

1. 识别冲突/歧义（口径/边界/阈值/异常策略等）
2. 冲突记录格式：
   - 说法 A（EntryId + 短句 ≤25 字）vs 说法 B（EntryId + 短句 ≤25 字）
3. 若可从索引定位更早相关 Entry：额外拉取最多 10 条 Old Evidence EntryId（仅用于引用）

## Step 3 — 生成 inputs/00_intake.md（覆盖写入）

输出 MIS，不确定项写 `【待确认】`：

```markdown
# 最小事实集（MIS）

## 1. 目标
<一句话> + 受影响对象

## 2. 成功标准
指标 / 口径 / 期望变化

## 3. 流程边界
- 触发点：
- 结束点：

## 4. 参与方
| 角色/系统 | 职责 |
|-----------|------|

## 5. 关键规则（≤3 条）

## 6. 最常见异常/卡点（1 条）

## 7. 真实案例
优先从原文抽取 1 个；若无则要求补充

## 8. 冲突与歧义
冲突点 + EntryId 证据

## 9. 证据范围
- 主分析集：最新 N 条（EntryId 范围）
- Old Evidence：<若有则列出>
```

## Step 4 — 生成 outputs/01_process.md（覆盖写入：可讨论版）

结构固定，不确定项标 `【待确认】`。**§3 和 §5 必须含 Mermaid 图**。

```markdown
# 业务流程文档：<主题>

## 1. 业务目标与范围
In/Out 边界（无法判断的写【待确认】）

## 2. 角色 / 系统 / 数据对象

## 3. 主流程

### 3.1 流程图

（使用 flowchart TD 或 LR，遵循 SKILL.md 中的 Mermaid 语法规则）
（不确定的步骤节点用虚线框标注，如 A -.- B）

### 3.2 步骤明细表

| 步骤 | 角色/系统 | 动作 | 输入 | 输出 | 决策点 | 备注 |
|------|-----------|------|------|------|--------|------|
不确定步骤标【待确认】并引用 [来源N]

## 4. 异常与边界处理
最低覆盖集合：
- 权限控制
- 超时 / 重试
- 重复提交 / 幂等
- 人工介入
- 对账 / 纠错 / 撤销 / 回退

## 5. 状态机 / 生命周期

如适用：使用 stateDiagram-v2 画出状态流转图
不适用则标"本场景无独立状态机"并说明理由

## 6. 关键规则
校验 / 计算 / 路由 / 审批 / 幂等

## 7. Open Questions（≤10）
按优先级排列，每条包含：
- 问题（可秒回格式）
- 为何重要 / 风险
- 建议确认人
- 来源依据（如 [来源3]）

## 8. 引用与依据

| 编号 | 来源描述 | EntryId |
|------|---------|---------|
| [来源1] | <可读描述，如：李四关于退款审批的聊天记录（2/11）> | 20260211-1430-003 |
| [来源2] | ... | ... |

缺失则标【待补引用】并列检索主题 Top3
```

**Mermaid 自检**：生成后逐项核对 SKILL.md 中的 Mermaid 自检清单，确保语法正确。

## Step 5 — decisions.md 记录（追加）

```markdown
## Capture - <日期时间>
- 参数：last=N
- 主分析集 EntryId 范围：<起始> ~ <结束>
- Old Evidence：<若有则列出>
- Top10 确认点摘要：
  1. ...
  2. ...
  ...
```

## 完成后提示（必须向用户输出）

```
---
✅ 提炼骨架完成
   已生成流程初稿（outputs/01_process.md）+ N 个待确认问题

👉 下一步：生成确认清单
   说"生成确认清单"，我会产出可直接发给业务方的 IM 消息

💡 你也可以：
   - 先看看 outputs/01_process.md 流程初稿，有问题随时说
   - 追加更多材料后重新提炼（说"追加材料"）
   - 跳过确认直接说"生成 BRD"（将基于当前信息生成，未确认项标【待确认】）
---
```
